# 需求规格说明书 (SRS)

> 版本：1.0.0
> 更新日期：2026-02-02
> 状态：Phase 1 MVP

---

## 1. 功能需求

### 1.1 FR-001：快捷键唤起

**描述**：用户在任意 Windows 应用中按下快捷键，激活 scrcpy 窗口

| 属性 | 值 |
|------|-----|
| 优先级 | P0 |
| 触发条件 | 用户按下 `Alt + Space` |
| 前置条件 | scrcpy 已运行且手机已连接 |

**详细流程**：

```
1. 用户在 PC 软件（如 Word）中，光标定位到输入位置
2. 用户按下 Alt + Space
3. 系统记录当前活动窗口句柄（用于后续还原）
4. 系统激活 scrcpy 窗口
5. 系统将 scrcpy 窗口移动到屏幕中央
6. 系统调整窗口大小为预设值（宽 400px，高 700px）
```

**验收标准**：
- [ ] 从按下快捷键到窗口激活，延迟 < 500ms
- [ ] 原窗口句柄被正确记录
- [ ] scrcpy 窗口位于屏幕正中央
- [ ] 窗口大小符合预设

**异常处理**：

| 异常情况 | 处理方式 |
|----------|----------|
| scrcpy 未运行 | 弹出提示框，告知用户先启动 scrcpy |
| scrcpy 窗口最小化 | 先恢复窗口再激活 |
| 多个 scrcpy 实例 | 激活第一个匹配的窗口 |

---

### 1.2 FR-002：窗口位置与大小管理

**描述**：将 scrcpy 窗口调整到便于输入的位置和大小

| 属性 | 值 |
|------|-----|
| 优先级 | P0 |
| 触发时机 | FR-001 执行后自动触发 |

**配置参数**：

```
窗口宽度：400 像素（可配置）
窗口高度：700 像素（可配置）
窗口位置：屏幕水平居中，垂直居中
```

**计算公式**：

```
PosX = (屏幕宽度 - 窗口宽度) / 2
PosY = (屏幕高度 - 窗口高度) / 2
```

**验收标准**：
- [ ] 窗口精确居中（误差 < 5px）
- [ ] 多显示器环境下，在主显示器居中
- [ ] 窗口大小调整成功

---

### 1.3 FR-003：输入区域清空

**描述**：激活窗口后，自动清空输入容器中的残留文字

| 属性 | 值 |
|------|-----|
| 优先级 | P0 |
| 触发时机 | FR-002 执行后自动触发 |
| 依赖 | 输入容器 App 支持 Ctrl+A 和 Backspace |

**详细流程**：

```
1. 等待 scrcpy 窗口激活完成（100ms）
2. 发送 Ctrl+A（全选）
3. 等待 50ms
4. 发送 Backspace（删除）
5. 等待 50ms
6. 输入法自动弹出，就绪
```

**验收标准**：
- [ ] 上次残留的文字被清空
- [ ] 输入法弹出，可以开始输入
- [ ] 清空操作不影响手机剪贴板内容

**注意事项**：
- 某些 App 可能不支持 Ctrl+A，需要实测确认
- 如果 App 无内容，全选+删除不会有副作用

---

### 1.4 FR-004：内容复制与上屏

**描述**：用户完成输入后，按快捷键将内容复制并粘贴到原 PC 软件

| 属性 | 值 |
|------|-----|
| 优先级 | P0 |
| 触发条件 | scrcpy 窗口激活状态下，用户按下 `Ctrl + Enter` |

**详细流程**：

```
1. 用户在豆包输入法中完成输入（语音/AI/手动）
2. 用户按下 Ctrl + Enter
3. 系统发送 Ctrl+A（全选手机输入区内容）
4. 等待 50ms
5. 系统发送 Ctrl+C（复制到手机剪贴板）
6. 等待 300ms（等待剪贴板同步到 PC）
7. 系统最小化 scrcpy 窗口
8. 系统激活之前记录的原窗口
9. 等待 100ms（确保窗口激活完成）
10. 系统发送 Ctrl+V（粘贴）
```

**验收标准**：
- [ ] 手机输入区的全部内容被复制
- [ ] 内容正确粘贴到 PC 软件的原光标位置
- [ ] scrcpy 窗口被最小化
- [ ] 原窗口重新获得焦点

**时序约束**：

```
总耗时 < 1000ms
其中：
  - 全选+复制：~100ms
  - 剪贴板同步等待：~300ms（可配置）
  - 窗口切换：~100ms
  - 粘贴：~50ms
```

---

### 1.5 FR-005：焦点还原

**描述**：上屏完成后，PC 软件恢复到操作前的状态

| 属性 | 值 |
|------|-----|
| 优先级 | P0 |
| 触发时机 | FR-004 执行过程中自动触发 |

**验收标准**：
- [ ] 原窗口重新成为活动窗口
- [ ] 光标位置正确（粘贴位置正确）
- [ ] 用户可以继续在原软件中操作

---

## 2. 非功能需求

### 2.1 NFR-001：响应时间

| 操作 | 最大允许时间 |
|------|--------------|
| 快捷键唤起到窗口激活 | 500ms |
| 按下确认键到内容粘贴完成 | 1000ms |
| 剪贴板同步 | 500ms |

### 2.2 NFR-002：可靠性

| 指标 | 目标值 |
|------|--------|
| 单次操作成功率 | > 95% |
| 连续 10 次操作成功率 | > 90% |
| 剪贴板同步成功率 | > 98% |

### 2.3 NFR-003：可配置性

以下参数应支持用户自定义：

| 参数 | 默认值 | 说明 |
|------|--------|------|
| 唤起快捷键 | `Alt+Space` | 可改为其他组合 |
| 确认快捷键 | `Ctrl+Enter` | 可改为其他组合 |
| 窗口宽度 | 400px | scrcpy 窗口宽度 |
| 窗口高度 | 700px | scrcpy 窗口高度 |
| 剪贴板等待时间 | 300ms | 同步超时时间 |
| scrcpy 窗口标题 | `2505APX7BC` | 用于窗口匹配 |

### 2.4 NFR-004：兼容性

**目标应用兼容性测试**：

| 应用 | 优先级 | 备注 |
|------|--------|------|
| 微信 PC 版 | P0 | 主要使用场景 |
| Microsoft Word | P0 | 文档编辑 |
| Chrome 浏览器 | P0 | 网页表单 |
| VS Code | P1 | 代码注释 |
| 飞书 | P1 | 办公协作 |

---

## 3. 用户交互流程

### 3.1 主流程时序图

```
用户                    AHK 脚本                 scrcpy                  手机
 |                         |                       |                       |
 |-- Alt+Space ----------->|                       |                       |
 |                         |-- 记录原窗口句柄 ---->|                       |
 |                         |-- 激活窗口 ---------->|                       |
 |                         |-- 调整位置大小 ------>|                       |
 |                         |-- Ctrl+A, Backspace ->|------- 按键转发 ----->|
 |                         |                       |                       |
 |                         |                       |<-- 输入法弹出 ---------|
 |                         |                       |                       |
 |<=============================== 用户在手机上使用豆包输入 ===============>|
 |                         |                       |                       |
 |-- Ctrl+Enter ---------->|                       |                       |
 |                         |-- Ctrl+A, Ctrl+C ---->|------- 按键转发 ----->|
 |                         |                       |<-- 剪贴板同步 ---------|
 |                         |-- 最小化窗口 -------->|                       |
 |                         |-- 激活原窗口          |                       |
 |                         |-- Ctrl+V              |                       |
 |<-- 内容出现在光标处 ----|                       |                       |
```

### 3.2 状态机

```
                    ┌──────────────┐
                    │    IDLE      │ 空闲状态，等待唤起
                    └──────┬───────┘
                           │ Alt+Space
                           ▼
                    ┌──────────────┐
                    │   ACTIVE     │ scrcpy 窗口激活，等待输入
                    └──────┬───────┘
                           │ Ctrl+Enter
                           ▼
                    ┌──────────────┐
                    │  TRANSFER    │ 正在传输内容
                    └──────┬───────┘
                           │ 完成
                           ▼
                    ┌──────────────┐
                    │    IDLE      │ 返回空闲状态
                    └──────────────┘
```

---

## 4. 边界条件与异常场景

### 4.1 边界条件

| 场景 | 预期行为 |
|------|----------|
| 输入内容为空 | 正常执行，粘贴空内容（无影响） |
| 输入内容超长（>10000 字符） | 正常处理，剪贴板支持 |
| 输入内容含特殊字符（emoji、换行） | 正常处理 |
| 输入内容含格式（粗体、链接） | 取决于目标应用，通常粘贴纯文本 |

### 4.2 异常场景处理

| 异常 | 检测方式 | 处理方式 |
|------|----------|----------|
| scrcpy 未运行 | 窗口不存在 | 弹出提示 |
| scrcpy 窗口无响应 | 超时 | 提示用户重启 |
| 剪贴板同步失败 | 超时未变化 | 增加等待时间重试 |
| 原窗口已关闭 | 激活失败 | 粘贴到桌面（降级） |
| USB 断开 | scrcpy 退出 | 提示用户重连 |

---

## 5. 需求追踪矩阵

| 需求 ID | 需求名称 | 测试用例 | 状态 |
|---------|----------|----------|------|
| FR-001 | 快捷键唤起 | TC-001 | 待开发 |
| FR-002 | 窗口管理 | TC-002 | 待开发 |
| FR-003 | 输入区清空 | TC-003 | 待开发 |
| FR-004 | 内容上屏 | TC-004, TC-005 | 待开发 |
| FR-005 | 焦点还原 | TC-006 | 待开发 |
| NFR-001 | 响应时间 | TC-007 | 待开发 |
| NFR-002 | 可靠性 | TC-008 | 待开发 |
